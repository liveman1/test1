!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.PieContextMenu=e()}(this,function(){"use strict";var t,e,n,i,s,o="http://www.w3.org/2000/svg",u=function(t){this.menuablesClass=t.menuItemClass,this.numberOfButton=0,this.menu,this.menu_id=t.menuID,this.menuPosition,this.menu_model=t.menu_model||1,this.menu_svg,this.menu_svg_id=this.menu_id+"_svg",this.touchDuration=t.touchDuration||300,this.center,this.menuState=0,this.active="pie-context-menu--active",this.menuSize=t.menuSize,this.menuActivateEvent=t.menuActivateEvent||"contextmenu",this.radius,this.stroke_width,this.font_size,this.lastSelectedElement=null,this.buttons=[],this.init()};return u.Button=function(t,e,n){this.index=t,this.text=e,this.icon=n,this.isNew=!0,this.element},u.prototype.init=function(){this.menu=document.createElement("nav"),this.menu_svg=document.createElementNS(o,"svg"),this.menu.appendChild(this.menu_svg),this.center=document.createElementNS(o,"circle"),this.menu_svg.appendChild(this.center),this.reset(),this.create(),this.menuActivateListener(this.menuActivateEvent),this.leftClickListener(),this.keyupListener()},u.prototype.create=function(){null===document.getElementById(this.menu_id)&&document.body.appendChild(this.menu)},u.prototype.destroy=function(){null!=document.getElementById(this.menu_id)&&document.body.removeChild(this.menu)},u.prototype.reset=function(){this.closeMenu(),this.radius=this.menuSize/3,this.stroke_width=this.menuSize/5,this.font_size=Math.round(this.menuSize/12),this.menu.setAttribute("id",this.menu_id),this.menu.setAttribute("class","pie-context-menu"),this.menu.setAttribute("width",this.menuSize),this.menu.setAttribute("height",this.menuSize),this.menu_svg.setAttribute("id",this.menu_svg_id),this.menu_svg.setAttribute("width",this.menuSize),this.menu_svg.setAttribute("height",this.menuSize),this.draw()},u.prototype.menuActivateListener=function(n){var i,o;function c(e){i=setTimeout(()=>(function(e){e.preventDefault(),e.target.classList.contains(t.menuablesClass)&&t.openContextMenu(e)})(e),t.touchDuration)}function r(n){n.preventDefault(),e=t.getElementPoint(n);var i=[];if(t.buttons.forEach(function(t){i.push(t.element.id)}),e.classList.length&&"pcm_button"===e.classList[0]){if(e.parentNode.id){var s=e.parentNode.id;u.menu_button_mouseover(document.getElementById(s)),function(t,e){o=t.indexOf(e),t.forEach(function(t,e){o!==e&&u.menu_button_mouseout(document.getElementById(t))})}(i,s)}}else t.buttons.forEach(function(t){u.menu_button_mouseout(document.getElementById(t.element.id))})}t=this,document.addEventListener(n,function(e){(s=t.containsClass(e,t.menuablesClass))?(e.preventDefault(),t.lastSelectedElement=s,t.openMenu(),t.positionMenu(e)):t.closeMenu()}),document.addEventListener("touchstart",t=>c(t)),document.addEventListener("touchend",n=>(function(n){i&&clearTimeout(i),2===t.menu_model&&((e=t.getElementPoint(n)).classList.length&&"pcm_button"===e.classList[0]&&e.parentNode.id&&document.querySelector("#"+e.parentNode.id).dispatchEvent(new Event("click")),t.closeMenu())})(n),!1),document.addEventListener("touchmove",t=>r(t),{passive:!1})},u.prototype.openContextMenu=function(o){var u,c;o.preventDefault(),n=void 0===o.originalEvent?o:o.originalEvent,i=n.touches[0]||n.changedTouches[0],(s=t.containsClass(o,t.menuablesClass))&&(t.lastSelectedElement=s),(e=document.elementFromPoint(i.pageX,i.pageY)).classList.length&&e.classList[0]===t.menuablesClass&&(u=document.getElementsByClassName(t.menuablesClass)[0],c=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!1,view:window,button:2,buttons:0,clientX:i.pageX,clientY:i.pageY}),u.dispatchEvent(c))},u.prototype.getElementPoint=function(t){return n=void 0===t.originalEvent?t:t.originalEvent,i=n.touches[0]||n.changedTouches[0],document.elementFromPoint(i.pageX,i.pageY)},u.prototype.leftClickListener=function(){t=this,document.addEventListener("click",function(n){e=document.elementFromPoint(n.clientX,n.clientY),1===(n.which||n.button)&&(e.classList.length&&e.classList[0]===t.menuablesClass||t.closeMenu())})},u.prototype.keyupListener=function(){t=this,document.addEventListener("keydown",function(e){27===e.keyCode&&t.closeMenu()},!1)},u.prototype.closeMenu=function(){0!==this.menuState&&(this.menuState=0,this.menu.classList.remove(this.active))},u.prototype.openMenu=function(){1!==this.menuState&&(this.menuState=1,this.menu.classList.add(this.active))},u.prototype.positionMenu=function(t){this.menuPosition=this.getPosition(t);var e=this.menu.offsetWidth,n=this.menu.offsetHeight,i=this.menuPosition.x-e/2,s=this.menuPosition.y-n/2;this.menuPosition.x<e/2&&(i=0),this.menuPosition.y<n/2&&(s=0),this.menu.style.left=i+"px",this.menu.style.top=s+"px"},u.prototype.containsClass=function(t,e){var n=t.srcElement||t.target;if(n.classList.contains(e))return n;for(;n=n.parentNode;)if(n.classList&&n.classList.contains(e))return n;return!1},u.prototype.getPosition=function(t){var e=0,n=0;if(!t)t=window.event;return t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:n}},u.prototype.draw=function(){u.setCenterCircle(this.center,this.radius,this.menuSize);for(var t=0;t<this.numberOfButton;t++)this.createMenuButton(this.buttons[t])},u.prototype.createMenuButton=function(t){var e,n,i,s,c,r=t.index,m=t.text,a=t.icon,h=this.radius,l=this.stroke_width,d=this.font_size,p=this.numberOfButton;this.buttons[r].isNew?(e=document.createElementNS(o,"g"),n=document.createElementNS(o,"circle"),i=document.createElementNS(o,"text"),s=document.createElementNS(o,"text"),c=this.menu_id+"_button_"+(r+1),e.appendChild(n),e.appendChild(i),e.appendChild(s),this.menu_svg.appendChild(e),t.element=e,this.buttons[r].isNew=!1):(e=this.buttons[r].element,n=this.buttons[r].element.childNodes[0],i=this.buttons[r].element.childNodes[1],s=this.buttons[r].element.childNodes[2],c=this.buttons[r].element.id),u.setMenuButtonG(e,c,this.menuSize),u.setMenuButton(n,h,l,r,p),u.setMenuTitle(i,m,d),u.setMenuIcon(s,a,h,r,p,d)},u.prototype.resize=function(t){this.menuSize=t,this.reset()},u.prototype.addButton=function(t,e){this.buttons[this.numberOfButton]=new u.Button(this.numberOfButton,t,e),this.numberOfButton++,this.reset()},u.Button.prototype.changeText=function(t){this.text=t,this.element.childNodes[1].textContent=this.text},u.Button.prototype.changeIcon=function(t){this.icon=t,this.element.childNodes[2].textContent=t},u.setMenuButtonG=function(t,e,n){return t.setAttribute("id",e),t.setAttribute("class","pcm_group"),t.setAttribute("transform","translate("+n/2+","+n/2+")"),t.addEventListener("mouseover",function(t){u.menu_button_mouseover(this)}),t.addEventListener("mouseout",function(t){u.menu_button_mouseout(this)}),t},u.setMenuButton=function(t,e,n,i,s){t.setAttribute("class","pcm_button"),t.setAttribute("r",e),t.setAttribute("stroke-width",n);var o=2*Math.PI*e,u=o/s+o/500,c=360/s*i-180;return t.setAttribute("stroke-dasharray",u+" "+o),t.setAttribute("transform","rotate("+c+",0,0)"),t},u.setMenuTitle=function(t,e,n){return t.textContent=e,t.setAttribute("class","pcm_title"),t.setAttribute("y","0.35em"),t.setAttribute("font-size",n),t.setAttribute("display","none"),t},u.setMenuIcon=function(t,e,n,i,s,o){var c=-1*(360/s*i-180+180/s),r=u.polarToCartesian(n,c);return t.textContent=e,t.setAttribute("class","pcm_icon"),t.setAttribute("x",r.x),t.setAttribute("y",-r.y),t.setAttribute("dy","0.35em"),t.setAttribute("font-size",o),t},u.setCenterCircle=function(t,e,n){t.setAttribute("class","pcm_center"),t.setAttribute("r",e),t.setAttribute("transform","translate("+n/2+","+n/2+")")},u.polarToCartesian=function(t,e){var n=e*(Math.PI/180);return{x:t*Math.cos(n),y:t*Math.sin(n)}},u.faviconClassToText=function(t){var e=document.createElement("i");e.className=t,document.body.appendChild(e);var n=getComputedStyle(e,":before").content;return n=(n=n.substr(1)).substr(0,n.length-1),document.body.removeChild(e),n},u.menu_button_mouseover=function(t){t.childNodes[0].classList.add("pcm_button--hover"),t.childNodes[1].setAttribute("display","inline"),t.childNodes[2].classList.add("pcm_icon--hover")},u.menu_button_mouseout=function(t){t.childNodes[0].classList.remove("pcm_button--hover"),t.childNodes[1].setAttribute("display","none"),t.childNodes[2].classList.remove("pcm_icon--hover")},u});